<aura:component controller="CustomDocumentController" implements="force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:availableForAllPageTypes" access="global" >
    
	<aura:attribute name="Document" type="Document_Helper__c"
     default="{'sobjectType': 'Document_Helper__c','Name__c':'','Sensitivity__c': 'Restricted','Id':'','ConvertToDocuments__c':true}"/>
    <aura:attribute name="ReviewItemFiles" type="Object"/>
    <aura:attribute name="uploadView" type="String" default="uploadView"/>
    <aura:attribute name="IsCommunity" type="Boolean"/>
    
    <aura:attribute name="listOptions" type="List" default="[]"/>
    <aura:attribute name="defaultOptions" type="List" default="[]"/>
    <aura:attribute name="requiredOptions" type="List" default="[]"/>
    <aura:attribute name="selectedArray" type="List"/>
    <aura:attribute name="NewTagValue" type="String" default=""/>
    
    <ltng:require styles="{!$Resource.DHTMLX + '/codebase/dhtmlx.css'}"/>  
    <ltng:require scripts="{!$Resource.DHTMLX + '/codebase/dhtmlxtree.js'}"/>  

    
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
    
    <lightning:layout horizontalAlign="end">
        <lightning:button label="New" variant="brand" onclick="{!c.openmodal}" class="newButt"/>
        
    </lightning:layout>
    <lightning:listView aura:id="listViewAccounts"
        objectApiName="Document__c"
        listName="All"
        rows="10"
        showSearchBar="true"
        showActionBar="false"
        enableInlineEdit="true"
        showRowLevelActions="false"
	/>
    
    <div aura:id="Modalbox" role="dialog" tabindex="-1" aria-labelledby="header43" class="slds-modal" style="">
        <div class="slds-modal__container">
                <div class="slds-modal__header">
                    <h2 class="slds-text-heading--medium">Upload Documents</h2>
            </div>
            <aura:if isTrue="{!v.uploadView=='uploadView'}">
                <div class="slds-modal__content slds-p-around--medium slds-grid slds-wrap ">
                    <h3 style="font-size: 12px;width:100%;margin-bottom: 15px;">
                    Upload similar documents in groups of one or more, so that each group of similar documents has the same tags applied to them.
                    </h3>
                    
                    <div class="slds-col slds-size_3-of-3">
                        <lightning:fileUpload label="Attach Files" 
                                              name="fileUploader"
                                              multiple="true"
                                              recordId="{!v.Document.Id}"
                                              onuploadfinished="{!c.onUploadFinished}"/>
                        
                    </div>
                    <div class="slds-grid slds-wrap slds-col slds-size_4-of-4">
                        <aura:iteration items="{!v.ReviewItemFiles}" var="file">
                            <div class="slds-col slds-size_2-of-4">
                                <lightning:fileCard fileId="{!file.Id}"/>
                            </div>
                        </aura:iteration>
                    </div>
                    
                    
                    <lightning:recordEditForm aura:id="recordCreateForm" objectApiName="Document__c" class="recForm">
                        <lightning:messages />
                        <lightning:layout multipleRows="true">
                            <lightning:layoutItem size="3">
                                <lightning:inputField fieldName="Sensitivity__c" value="{!v.Document.Sensitivity__c}" />
                            </lightning:layoutItem>
                            <lightning:layoutItem>
                                 <aura:iteration items="{!v.defaultOptions}" var="tag" indexVar="index">
                                     <div style="padding-top: 30px;padding-left: 5px; display: inline-block;">
                                    	<lightning:pill label="{!tag.label}" name="{!tag.value}" onremove="{! c.handleRemove }"/>
                                     </div>
                                </aura:iteration>
                              
                            </lightning:layoutItem>
                            <div class="slds-size_2-of-12" style="padding-top: 30px;padding-left: 15px;">
                                <a onclick="{!c.chageViewToTags}">Add tag...</a>
                            </div>
                        </lightning:layout>
                    </lightning:recordEditForm>
                </div>
            </aura:if> 
            <aura:if isTrue="{!v.uploadView=='tagView'}">
                <div class="slds-modal__content slds-p-around--medium slds-grid slds-wrap ">
                    <h3 style="font-size: 12px;width:100%;margin-bottom: 15px;">
                    Upply one or more tags to make it easier to locate documents later in due diligence process.
                    </h3>
                    <div class="slds-size_12-of-12">
                    	<lightning:button variant="neutral" label="Back" onclick="{!c.chageViewToUpload}"/>
                    </div>
                    <div class="slds-form--stacked slds-p-around--medium slds-m-bottom--x-small" style="width:100%">
                      	<aura:if isTrue="{!v.IsCommunity}">
                            <iframe aura:id="vfFrame" style="border: none;min-height:230px;width: 100%;" src="{!'/fintech/apex/dhtmlxTags' + '?id=' + v.Document.Id}"/>
                        	<aura:set attribute="else">
                                <iframe aura:id="vfFrame" style="border: none;min-height:230px;width: 100%;" src="{!'/apex/dhtmlxTags' + '?id=' + v.Document.Id}"/>
                            </aura:set>
                        </aura:if>
                        <a style="display:block" onclick="{!c.chageViewToEditTags}">Edit tags...</a>
                      <!--lightning:dualListbox aura:id="selectOptions" name="Select Options"  label="Select Options" 
                                               sourceLabel="Available Tags:" 
                                               selectedLabel="Selected Tags:" 
                                               options="{! v.listOptions }"
                                               value="{! v.defaultOptions }"
                                               requiredOptions="{! v.requiredOptions }"
                                               onchange="{! c.handleChange }"
                                               min="0"
                                               /-->
                        
                      <!--div class="slds-grid slds-gutters">
                          <div class="slds-col slds-size_6-of-12">
                            <span><lightning:input style="" class="NewTagValue" name="NewTagValue" placeholder="Add New Tag..." value="{!v.NewTagValue}"/></span>
                          </div>
                          <div class="slds-col slds-size_3-of-12">
                            <span><lightning:button variant="brand" class="AddButt" label="Add" title="Add" onclick="{! c.addNewTag }"/></span>
                          </div>
                     </div-->
                    </div>
                                        
                    
                    
                </div>
            </aura:if> 
            <aura:if isTrue="{!v.uploadView=='tagEditView'}">
                <div class="slds-modal__content slds-p-around--medium slds-grid slds-wrap ">
                    <h3 style="font-size: 12px;width:100%;margin-bottom: 15px;">
                        Drag and drop tags to create hierarchies. Use right/context menu to add, rename or delete tags:
                    </h3>
                    <div class="slds-size_12-of-12">
                    	<lightning:button variant="neutral" label="Back" onclick="{!c.chageViewToTags}"/>
                    </div>
                    <div class="slds-form--stacked slds-p-around--medium slds-m-bottom--x-small" style="width:100%">
                      	<aura:if isTrue="{!v.IsCommunity}">
                            <iframe aura:id="vfFrame" style="border: none;min-height:250px;width: 100%;" src="{!'/fintech/apex/dhtmlxEditTags'}"/>
                        	<aura:set attribute="else">
                                <iframe aura:id="vfFrame" style="border: none;min-height:250px;width: 100%;" src="{!'/apex/dhtmlxEditTags'}"/>
                            </aura:set>
                        </aura:if>
                    </div>
                                        
                    
                    
                </div>
            </aura:if> 
            <div class="slds-modal__footer">                
                <lightning:button variant="neutral" label="Cancel" onclick="{!c.closeModal}"/>
                <lightning:button variant="brand" label="Save" onclick="{!c.saveRecord}" />
            </div>
        </div>
    </div>
    <div aura:id="Modalbackdrop" class="slds-backdrop"></div>
</aura:component>